# Comandos de Consola - Gu√≠a de Testing (Modo Offline)

Gu√≠a organizada para probar todas las funcionalidades del sistema de gamificaci√≥n antes de crear la UI.

> üí° **Tip:** Haz clic en las secciones (‚ñ∂) para expandir/colapsar
> üìã Todos los comandos son **copy-paste ready**
> ‚ö†Ô∏è **IMPORTANTE:** Ejecuta estos comandos desde la consola del navegador, NO desde el terminal
> üîß **MODO OFFLINE:** Todo se guarda en localStorage del navegador, sin servidor

---

## üöÄ Inicio R√°pido - Quick Tests

<details open>
<summary>‚ö° Tests B√°sicos (< 1 minuto)</summary>

### 1. Verificar Sistema de Gamificaci√≥n

```javascript
// La gamificaci√≥n se inicializa autom√°ticamente al cargar cualquier App (2-5)
// Verificar que est√© activa:
window.__GAMIFICATION.getStats()
// Retorna: { session: {...}, scoring: {...}, achievements: {...}, storage: {...} }

// Ver tu nivel actual
window.__GAMIFICATION.getUserLevel()
// Retorna: { level: 1, currentXP: 0, nextLevelXP: 100, title: "Principiante" }

// Ver nombre de usuario
window.__USER_MANAGER.getUserDisplayName()
// Retorna: "Usuario"
```

**‚úÖ Todo funciona si:** Obtienes objetos con datos, no errores

</details>

<details>
<summary>üéØ Test de Tracking de Eventos</summary>

### 2. Trackear Acci√≥n de la App Actual

```javascript
// La app ya est√° inicializada autom√°ticamente al cargar la p√°gina
// Puedes trackear acciones directamente:

// Para App2 - Sucesi√≥n de Pulsos
window.__GAMIFICATION.trackAppAction('play_clicked', { duration: 30 });

// Para App3 - Fracciones Temporales
window.__GAMIFICATION.trackAppAction('fraction_created', { numerator: 1, denominator: 4 });

// Para App4 - Pulsos Fraccionados
window.__GAMIFICATION.trackAppAction('pulse_pattern_created', { pattern: [1,0,1,0] });

// Para App5 - Pulsaciones
window.__GAMIFICATION.trackAppAction('play_started', { duration: 30 });

// Ver resultado
console.log('‚úÖ Evento trackeado correctamente');
```

**Acciones disponibles por app:**
- **App2 (Sucesi√≥n de Pulsos):** `play_clicked`, `tap_tempo_used`, `loop_enabled`, `parameter_changed`, `randomize_used`, `pulse_selected`
- **App3 (Fracciones Temporales):** `fraction_created`, `parameter_changed`, `complexity_changed`
- **App4 (Pulsos Fraccionados):** `fraction_created`, `pulse_pattern_created`, `parameter_changed`, `cycle_activated`
- **App5 (Pulsaciones):** `play_started`, `interval_created`, `pattern_modified`, `parameter_changed`

</details>

---

## üé§ Tests de Audio Capture

<details>
<summary>‚å®Ô∏è Test 1: Keyboard Capture (5 segundos)</summary>

### Captura de Taps con Teclado

**Descripci√≥n:** Captura 5 taps con ESPACIO
**Duraci√≥n:** ~5 segundos

```javascript
const { createKeyboardCapture } = await import('../../libs/gamification/index.js');

const keyboard = createKeyboardCapture();
console.log('‚å®Ô∏è  Presiona ESPACIO 5 veces...');
keyboard.startRecording();

// Esperar a que termines
await new Promise(resolve => setTimeout(resolve, 10000));

const taps = keyboard.stopRecording();
console.log('‚úÖ Capturados', taps.length, 'taps');
console.log('üìä Timestamps (ms):', taps.map(t => Math.round(t)));

// Calcular intervalos entre taps
if (taps.length > 1) {
  const intervals = [];
  for (let i = 1; i < taps.length; i++) {
    intervals.push(Math.round(taps[i] - taps[i-1]));
  }
  console.log('‚è±Ô∏è  Intervalos (ms):', intervals);
}
```

**‚úÖ Resultado esperado:**
- 5 timestamps en milisegundos
- Intervalos razonables entre taps (ej: 200-1000ms)

**‚ö†Ô∏è Troubleshooting:**
- Si no detecta las teclas, haz clic en la p√°gina principal (fuera de DevTools)
- El foco debe estar en la p√°gina, no en la consola

</details>

<details>
<summary>üé§ Test 2: Microphone Capture (7 segundos)</summary>

### Captura de Beats con Micr√≥fono + Calibraci√≥n Autom√°tica

**Descripci√≥n:** Calibra el ruido de fondo y detecta beats del micr√≥fono
**Duraci√≥n:** ~7 segundos (2s calibraci√≥n + 5s captura)
**Requisito:** Permiso de micr√≥fono

```javascript
const { createMicrophoneCapture } = await import('../../libs/gamification/index.js');

// Crear instancia
const mic = await createMicrophoneCapture({ threshold: -30, cooldown: 200 });

// PASO 1: Calibrar autom√°ticamente el ruido de fondo
console.log('üé§ CALIBRACI√ìN AUTOM√ÅTICA');
console.log('   Mant√©n silencio durante 2 segundos...');
await mic.calibrateNoiseFloor(2000);

// PASO 2: Capturar beats con el threshold calibrado
console.log('\nüé§ CAPTURA DE BEATS');
console.log('   Ahora golpea cerca del micr√≥fono o aplaude durante 5 segundos...');

mic.startRecording();
await new Promise(resolve => setTimeout(resolve, 5000));
const beats = mic.stopRecording();

console.log('\nüìä RESULTADOS:');
console.log(`‚úÖ Detectados ${beats.length} beats`);
if (beats.length > 0) {
  console.log('üìç Timestamps (ms):', beats.map(b => Math.round(b)));

  // Calcular intervalos entre beats
  if (beats.length > 1) {
    const intervals = [];
    for (let i = 1; i < beats.length; i++) {
      intervals.push(Math.round(beats[i] - beats[i-1]));
    }
    console.log('‚è±Ô∏è  Intervalos (ms):', intervals);

    // Estimar BPM
    if (intervals.length >= 2) {
      const avgInterval = intervals.reduce((a,b) => a+b) / intervals.length;
      const bpm = Math.round(60000 / avgInterval);
      console.log(`üéµ BPM estimado: ${bpm}`);
    }
  }
}

mic.dispose();
```

**‚úÖ Resultado esperado:**
- Calibraci√≥n detecta el ruido ambiente y ajusta el threshold (margen de 3-4.5 dB sobre el m√°ximo ruido)
- Beats detectados cuando golpeas/aplaudes
- El threshold calibrado se adapta a tu entorno

**‚ö†Ô∏è Troubleshooting:**
- Si no detecta beats: El ambiente es muy ruidoso, prueba con threshold manual m√°s bajo (-20 dB)
- Si detecta demasiados beats falsos: El ambiente es muy silencioso, prueba con threshold manual m√°s alto (-35 dB)

**Variante con threshold manual (sin calibraci√≥n):**
```javascript
const mic = await createMicrophoneCapture({ threshold: -25, cooldown: 200 });
console.log('üé§ Threshold manual: -25 dB');
mic.startRecording();
await new Promise(resolve => setTimeout(resolve, 5000));
const beats = mic.stopRecording();
console.log('‚úÖ Beats:', beats.length);
mic.dispose();
```

</details>

<details>
<summary>üîç Test 3: Rhythm Analyzer (instant√°neo)</summary>

### An√°lisis de Precisi√≥n de Timing

**Descripci√≥n:** Analiza precisi√≥n de taps contra patr√≥n esperado
**Duraci√≥n:** Instant√°neo

```javascript
const { createRhythmAnalyzer, fractionsToTimestamps } = await import('../../libs/gamification/index.js');

// Patr√≥n esperado: 4 pulsos a 120 BPM (fracciones: 0, 0.25, 0.5, 0.75)
const expected = fractionsToTimestamps([0, 0.25, 0.5, 0.75], 120);
console.log('‚è±Ô∏è  Patr√≥n esperado (120 BPM):', expected.map(t => Math.round(t)));

// Simular taps del usuario (con peque√±os errores de ¬±25ms)
const userTaps = expected.map(t => t + Math.random() * 50 - 25);
console.log('üë§ Taps del usuario:', userTaps.map(t => Math.round(t)));

// Analizar
const analyzer = createRhythmAnalyzer();
const result = analyzer.compareRhythm(userTaps, expected);

console.log('\nüìä AN√ÅLISIS:');
console.log('  ‚úÖ Accuracy:', Math.round(result.accuracy * 100), '%');
console.log('  ‚è±Ô∏è  Timing Accuracy:', Math.round(result.timingAccuracy * 100), '%');
console.log('  üéØ Consistency Score:', Math.round(result.consistencyScore * 100), '%');
console.log('  üéµ Tempo Accuracy:', Math.round(result.tempoAccuracy * 100), '%');
console.log('  üìâ Deviations (ms):', result.deviations.map(d => Math.round(d)));
console.log('  ‚ùå Missed taps:', result.missedTaps);
console.log('  ‚ûï Extra taps:', result.extraTaps);
```

**‚úÖ Resultado esperado:**
- Accuracy ~90-95% (con errores peque√±os de ¬±25ms)
- Timing Accuracy alta si los taps est√°n cerca de los esperados
- Consistency Score alta si el ritmo es regular
- Tempo Accuracy alta si mantiene el BPM

</details>

---

## üéº Tests de Ejercicios de Entrenamiento

<details>
<summary>üß™ Test 4: Guardar Intento Manualmente (instant√°neo)</summary>

### Guardar Resultado de Ejercicio en localStorage

**Descripci√≥n:** Guardar un intento de ejercicio en localStorage
**Duraci√≥n:** Instant√°neo

```javascript
const { recordAttempt } = await import('../../libs/gamification/index.js');

// Crear un intento de ejemplo
const result = recordAttempt({
  exercise_type: 'sequence-entry_level_1',
  exercise_title: 'Entrada de Secuencia - Nivel 1',
  score: 85,
  accuracy: 92,
  metadata: {
    timing_accuracy: 88,
    consistency: 95,
    taps_count: 5
  }
});

console.log('üìù Resultado:', result);
// Retorna: { success: true, attempt_id: "...", message: "..." }

// Ver intentos guardados
const attempts = JSON.parse(localStorage.getItem('gamification_exercise_attempts') || '[]');
console.log(`üìä Total intentos guardados: ${attempts.length}`);
console.log('üéØ √öltimos 3 intentos:');
console.table(attempts.slice(-3));
```

**‚úÖ Resultado esperado:**
- `success: true`
- Intento guardado en localStorage con ID √∫nico
- Se puede consultar despu√©s con `localStorage.getItem('gamification_exercise_attempts')`

</details>

<details>
<summary>‚è±Ô∏è Test 5: Count-In Visual + Audio (2-4 segundos)</summary>

### Count-In con Feedback Visual y Audio

**Descripci√≥n:** Prueba el count-in con feedback visual y audio
**Duraci√≥n:** ~2-4 segundos (depende del BPM)
**Requisito:** M√≥dulo ear-training cargado

```javascript
// CountInController est√° disponible globalmente en window.__EAR_TRAINING
if (!window.__EAR_TRAINING) {
  console.log('‚ùå M√≥dulo ear-training no disponible');
  console.log('‚ÑπÔ∏è  Este test requiere el m√≥dulo ear-training (disponible en App4)');
} else {
  const { CountInController } = window.__EAR_TRAINING;

  // Crear count-in de 4 beats a 120 BPM
  const countIn = new CountInController({
    beats: 4,
    bpm: 120,
    visualFeedback: true,
    audioFeedback: true
  });

  console.log('‚è±Ô∏è  Iniciando count-in...');
  console.log('üì∫ Deber√≠as ver n√∫meros grandes: 4, 3, 2, 1');
  console.log('üîä Y escuchar un click en cada beat');

  await countIn.play();

  console.log('‚úÖ Count-in completado!');
}
```

**Qu√© hace:**
1. Crea overlay fullscreen con fondo oscuro
2. Muestra n√∫meros grandes (4 ‚Üí 3 ‚Üí 2 ‚Üí 1) con animaci√≥n pulse
3. Muestra barra de progreso con c√≠rculos
4. Reproduce click (MIDI 76) en cada beat
5. Sincroniza visual + audio con setTimeout
6. Limpia elementos al terminar

**‚úÖ Resultado esperado:**
- Overlay aparece con n√∫meros animados
- 4 clicks de audio (uno por beat)
- Intervalo de 500ms entre beats (60000/120)
- Overlay desaparece al terminar

**Variantes para probar:**
```javascript
if (window.__EAR_TRAINING) {
  const { CountInController } = window.__EAR_TRAINING;

  // Count-in r√°pido (240 BPM = 250ms/beat)
  const fast = new CountInController({ beats: 4, bpm: 240 });
  await fast.play();

  // Count-in lento (60 BPM = 1000ms/beat)
  const slow = new CountInController({ beats: 4, bpm: 60 });
  await slow.play();

  // Solo visual (sin audio)
  const silent = new CountInController({ beats: 4, bpm: 120, audioFeedback: false });
  await silent.play();

  // Solo audio (sin visual)
  const noVisual = new CountInController({ beats: 4, bpm: 120, visualFeedback: false });
  await noVisual.play();
}
```

</details>

<details>
<summary>üéº Test 6: Fraction Recognition (2-3 minutos)</summary>

### Ejercicio Completo de Reconocimiento de Fracciones

**Descripci√≥n:** Ejecuta Ejercicio 4 Nivel 1 (10 preguntas, fracciones simples)
**Duraci√≥n:** ~2-3 minutos (autom√°tico con respuestas simuladas)
**Requisito:** M√≥dulo ear-training y Tone.js inicializado

**‚ö†Ô∏è REQUISITOS PREVIOS:**
- Tone.js debe estar inicializado (contexto de audio activo)
- Si est√°s en la pantalla inicial de App4, primero haz clic en "Inicio" o ejecuta: `await Tone.start()`

```javascript
// Verificar disponibilidad del m√≥dulo
if (!window.__EAR_TRAINING) {
  console.log('‚ùå M√≥dulo ear-training no disponible');
  console.log('‚ÑπÔ∏è  Este test requiere el m√≥dulo ear-training (disponible en App4)');
} else {
  const { FractionRecognitionExercise } = window.__EAR_TRAINING;

  // Crear ejercicio
  const ex4 = new FractionRecognitionExercise();
  await ex4.initialize();

  console.log('üéº Ejercicio 4: Reconocimiento de Fracciones');
  console.log('üìù Nivel 1: Fracciones simples (n=1, d=1-12)');
  console.log('üîä 10 preguntas con audio de subdivisiones');
  console.log('');
  console.log('‚ö†Ô∏è  En modo consola, las respuestas se simulan autom√°ticamente (70% correctas)');
  console.log('');

  // Ejecutar nivel 1 (10 preguntas)
  const result = await ex4.runLevel(1);

  // Mostrar resultado
  console.log('\nüèÜ RESULTADO FINAL:');
  console.log('  Correctas:', result.correctCount, '/', result.totalQuestions);
  console.log('  Accuracy:', Math.round(result.accuracy), '%');
  console.log('  Passed:', result.passed ? '‚úÖ S√ç' : '‚ùå NO');
  console.log('  Total listens:', result.totalListenCount);

  // Limpiar recursos
  ex4.dispose();
}
```

**Qu√© hace:**
1. Genera 10 preguntas random con fracciones 1/d (d entre 1 y 12)
2. Para cada pregunta:
   - Reproduce audio con la subdivisi√≥n usando gridFromOrigin
   - Simula respuesta del usuario (70% correctas en modo consola)
   - Valida la respuesta
3. Calcula accuracy final y determina si pas√≥ (‚â•80%)
4. **Guarda el resultado autom√°ticamente** en localStorage

**‚úÖ Resultado esperado:**
- 10 preguntas completadas
- ~7 correctas (simulaci√≥n 70%)
- Audio se reproduce (escuchar√°s clicks de accent + base)
- El resultado se guarda en localStorage

**Nota:** En una UI real, el usuario ingresar√≠a n y d manualmente.

</details>

---

## üéÆ Tests de Gamificaci√≥n Completos

<details>
<summary>üìä Ver Estad√≠sticas y Progreso</summary>

### Consultar Estado del Sistema de Gamificaci√≥n

```javascript
// Ver estad√≠sticas generales
const stats = window.__GAMIFICATION.getStats();
console.log('üìä Estad√≠sticas Generales:');
console.table(stats.session);
console.table(stats.scoring);
console.table(stats.achievements);

// Ver nivel del usuario
const level = window.__GAMIFICATION.getUserLevel();
console.log(`\nüéñÔ∏è  NIVEL: ${level.level} - ${level.title}`);
console.log(`   XP actual: ${level.currentXP}`);
console.log(`   XP para siguiente nivel: ${level.nextLevelXP}`);
console.log(`   Progreso: ${Math.round(level.progress * 100)}%`);

// Ver todos los logros
const achievements = window.__GAMIFICATION.getAchievements();
const unlocked = achievements.filter(a => a.unlocked);
console.log(`\nüèÜ LOGROS: ${unlocked.length}/${achievements.length} desbloqueados`);
console.table(unlocked);

// Ver progreso de un logro espec√≠fico
const comboProgress = window.__GAMIFICATION.getAchievementProgress('combo_master');
console.log('\nüéØ Progreso de "Combo Master":');
console.log(`   ${comboProgress.current}/${comboProgress.target} (${comboProgress.percentage}%)`);
```

</details>

<details>
<summary>üíæ Ver Intentos de Ejercicios</summary>

### Consultar Intentos Guardados en localStorage

```javascript
// Ver todos los intentos guardados
const attempts = JSON.parse(localStorage.getItem('gamification_exercise_attempts') || '[]');
console.log(`üìä Total intentos: ${attempts.length}`);
console.table(attempts);

// Ver √∫ltimos 5 intentos
const last5 = attempts.slice(-5);
console.log('\nüéØ √öltimos 5 intentos:');
console.table(last5);

// Filtrar por tipo de ejercicio
const sequenceAttempts = attempts.filter(a => a.exercise_type.includes('sequence'));
console.log(`\nüî¢ Intentos de secuencia: ${sequenceAttempts.length}`);
console.table(sequenceAttempts);

// Ver mejores scores
const sortedByScore = [...attempts].sort((a, b) => b.score - a.score);
console.log('\nüèÜ Top 5 scores:');
console.table(sortedByScore.slice(0, 5));

// Calcular accuracy promedio
if (attempts.length > 0) {
  const avgAccuracy = attempts.reduce((sum, a) => sum + a.accuracy, 0) / attempts.length;
  console.log(`\nüìà Accuracy promedio: ${avgAccuracy.toFixed(1)}%`);
}
```

</details>

<details>
<summary>üë§ Gesti√≥n de Usuario</summary>

### Comandos de Usuario

```javascript
// Ver nombre del usuario actual
window.__USER_MANAGER.getUserDisplayName()
// Retorna: "Usuario"

// Cambiar nombre de usuario
window.__USER_MANAGER.setUserDisplayName("Mi Nombre")
// Consola: "‚úÖ Nombre cambiado a: Mi Nombre"

// Ver informaci√≥n completa del usuario
window.__USER_MANAGER.getUserInfo()
// Retorna: { displayName: "Mi Nombre", createdAt: 1697234567890 }

// Resetear usuario (para testing)
window.__USER_MANAGER.resetUser()
// Consola: "üîÑ Datos de usuario reseteados"
```

**Nota:** Ya no hay sistema de m√∫ltiples usuarios ni conexi√≥n a servidor.

</details>

<details>
<summary>üíæ Backup y Restore</summary>

### Exportar/Importar Datos

```javascript
// Exportar todos los datos del usuario (para backup)
const backup = window.__GAMIFICATION.exportUserData();
console.log('üì¶ Datos exportados:', backup);

// Guardar backup en archivo (copiar JSON y pegarlo en un archivo)
copy(JSON.stringify(backup, null, 2));
console.log('‚úÖ Backup copiado al portapapeles - p√©galo en un archivo .json');

// Importar datos desde backup
// Pega aqu√≠ tu backup JSON
const myBackup = {
  "version": "1.0.0",
  "export_date": "2025-10-15T...",
  // ... resto del backup
};

window.__GAMIFICATION.importUserData(myBackup);
console.log('‚úÖ Datos restaurados desde backup');

// Resetear sesi√≥n actual (mantiene logros y puntos totales)
window.__GAMIFICATION.resetSession();

// Resetear TODO (¬°cuidado!)
window.__GAMIFICATION.resetAll();
```

</details>

---

## üîÑ Workflow de Testing Completo

<details open>
<summary>üéØ Flujo Completo: Testing de Todas las Funcionalidades</summary>

### Workflow Recomendado (Ejecutar en Orden)

Este flujo prueba todas las funcionalidades en ~10 minutos:

```javascript
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASO 1: Configuraci√≥n Inicial (10 segundos)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
console.log('üöÄ PASO 1: Configuraci√≥n Inicial');
window.__USER_MANAGER.setUserDisplayName("Tester");
const initialStats = window.__GAMIFICATION.getStats();
console.log('‚úÖ Sistema inicializado');
console.table(initialStats.session);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASO 2: Test de Keyboard Capture (10 segundos)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
console.log('\n‚å®Ô∏è  PASO 2: Keyboard Capture');
const { createKeyboardCapture } = await import('../../libs/gamification/index.js');
const keyboard = createKeyboardCapture();
console.log('   Presiona ESPACIO 5 veces...');
keyboard.startRecording();
await new Promise(resolve => setTimeout(resolve, 10000));
const keyboardTaps = keyboard.stopRecording();
console.log(`‚úÖ ${keyboardTaps.length} taps capturados`);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASO 3: Test de Microphone Capture (7 segundos)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
console.log('\nüé§ PASO 3: Microphone Capture + Calibraci√≥n');
const { createMicrophoneCapture } = await import('../../libs/gamification/index.js');
const mic = await createMicrophoneCapture({ threshold: -30, cooldown: 200 });
console.log('   Mant√©n silencio 2s...');
await mic.calibrateNoiseFloor(2000);
console.log('   Ahora golpea/aplaude 5s...');
mic.startRecording();
await new Promise(resolve => setTimeout(resolve, 5000));
const micBeats = mic.stopRecording();
console.log(`‚úÖ ${micBeats.length} beats detectados`);
mic.dispose();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASO 4: Test de Rhythm Analyzer (instant√°neo)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
console.log('\nüîç PASO 4: Rhythm Analyzer');
const { createRhythmAnalyzer, fractionsToTimestamps } = await import('../../libs/gamification/index.js');
const expected = fractionsToTimestamps([0, 0.25, 0.5, 0.75], 120);
const userTaps = expected.map(t => t + Math.random() * 50 - 25);
const analyzer = createRhythmAnalyzer();
const rhythmResult = analyzer.compareRhythm(userTaps, expected);
console.log(`‚úÖ Accuracy: ${Math.round(rhythmResult.accuracy * 100)}%`);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASO 5: Guardar Intento de Ejercicio (instant√°neo)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
console.log('\nüß™ PASO 5: Guardar Intento de Ejercicio');
const { recordAttempt } = await import('../../libs/gamification/index.js');
recordAttempt({
  exercise_type: 'test_workflow',
  exercise_title: 'Workflow Test',
  score: 95,
  accuracy: 98,
  metadata: { test: true }
});
console.log('‚úÖ Intento guardado');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASO 6: Trackear Eventos de App (instant√°neo)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
console.log('\nüéÆ PASO 6: Trackear Eventos');
window.__GAMIFICATION.trackEvent('practice_completed', { score: 95 });
console.log('‚úÖ Evento trackeado');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PASO 7: Verificar Estad√≠sticas Finales
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
console.log('\nüìä PASO 7: Estad√≠sticas Finales');
const finalStats = window.__GAMIFICATION.getStats();
const level = window.__GAMIFICATION.getUserLevel();
const attempts = JSON.parse(localStorage.getItem('gamification_exercise_attempts') || '[]');

console.log('\nüèÜ RESUMEN FINAL:');
console.log(`   Usuario: ${window.__USER_MANAGER.getUserDisplayName()}`);
console.log(`   Nivel: ${level.level} - ${level.title}`);
console.log(`   XP: ${level.currentXP}`);
console.log(`   Eventos: ${finalStats.session.totalEvents || 0}`);
console.log(`   Intentos guardados: ${attempts.length}`);
console.log('\n‚úÖ WORKFLOW COMPLETO - TODAS LAS FUNCIONALIDADES PROBADAS');
```

**‚è±Ô∏è Tiempo estimado:** ~10 minutos
**‚úÖ Todo funciona si:** Cada paso se completa sin errores

</details>

<details>
<summary>üéº Flujo con Fraction Recognition (solo App4)</summary>

### Workflow Completo Incluyendo Ejercicio de Fracciones

**Requisito:** Estar en App4 y tener Tone.js inicializado

```javascript
// Verificar que estamos en App4 y Tone.js est√° listo
if (!window.__EAR_TRAINING) {
  console.log('‚ùå Este flujo solo funciona en App4');
} else if (Tone.context.state !== 'running') {
  console.log('‚ö†Ô∏è  Primero inicializa Tone.js: await Tone.start()');
} else {
  console.log('üéº FLUJO COMPLETO CON FRACTION RECOGNITION\n');

  // ... Ejecutar PASOS 1-6 del workflow anterior ...

  // PASO ADICIONAL: Fraction Recognition (2-3 minutos)
  console.log('\nüéº PASO EXTRA: Fraction Recognition Exercise');
  const { FractionRecognitionExercise } = window.__EAR_TRAINING;
  const ex4 = new FractionRecognitionExercise();
  await ex4.initialize();
  console.log('   Ejecutando 10 preguntas...');
  const result = await ex4.runLevel(1);
  console.log(`‚úÖ Ejercicio completado: ${result.correctCount}/10 correctas (${Math.round(result.accuracy)}%)`);
  ex4.dispose();

  // Ver estad√≠sticas finales
  const finalStats = window.__GAMIFICATION.getStats();
  const level = window.__GAMIFICATION.getUserLevel();
  console.log('\nüèÜ RESUMEN FINAL CON EJERCICIO:');
  console.log(`   Nivel: ${level.level} - XP: ${level.currentXP}`);
  console.log(`   Intentos totales: ${JSON.parse(localStorage.getItem('gamification_exercise_attempts') || '[]').length}`);
  console.log('\n‚úÖ WORKFLOW COMPLETO CON EJERCICIO');
}
```

</details>

---

## üö® Troubleshooting

<details>
<summary>‚ö†Ô∏è Problemas Comunes</summary>

### Comando retorna Promise

**Problema:**
```javascript
window.__USER_MANAGER.getUserInfo()
// Retorna: Promise { <pending> }
```

**Soluci√≥n:** Algunos comandos requieren `await`
```javascript
const info = await window.__USER_MANAGER.getUserInfo()
```

---

### LocalStorage lleno

**Problema:** Error "QuotaExceededError" al guardar datos

**Soluci√≥n:**
```javascript
// Limpiar eventos antiguos
localStorage.removeItem('gamification_events')

// O resetear todo (¬°cuidado!)
window.__GAMIFICATION.resetAll()
```

---

### No detecta teclado en ejercicios

**Problema:** No detecta las teclas presionadas

**Soluci√≥n:**
1. **Hacer clic en la p√°gina principal** (fuera de DevTools)
2. Volver a presionar ESPACIO
3. El foco debe estar en la p√°gina, no en la consola

---

### "Cannot use import statement outside a module"

**Problema:** Intentando usar `import` en vez de `await import()`

**Soluci√≥n:**
```javascript
// ‚ùå MAL
import { ExerciseRunner } from '../../libs/ear-training/index.js';

// ‚úÖ BIEN
const { ExerciseRunner } = await import('../../libs/ear-training/index.js');
```

---

### Micr√≥fono no disponible

**Problema:** Navegador no tiene acceso al micr√≥fono

**Soluci√≥n:**
1. Permitir acceso al micr√≥fono en el navegador
2. Verificar que el micr√≥fono est√© conectado
3. Probar con `navigator.mediaDevices.getUserMedia({ audio: true })`

---

### Micr√≥fono no detecta beats o detecta demasiados

**Problema:** Calibraci√≥n no funciona bien en tu ambiente

**Soluci√≥n:**
```javascript
// Usar threshold manual en lugar de calibraci√≥n
const mic = await createMicrophoneCapture({ threshold: -20, cooldown: 200 });
// Ajusta el threshold seg√∫n tu ambiente:
// - Ambiente ruidoso: -15 a -20 dB
// - Ambiente normal: -25 a -30 dB
// - Ambiente muy silencioso: -35 a -40 dB
```

---

### Datos no persisten entre sesiones

**Problema:** Los datos desaparecen al cerrar el navegador

**Soluci√≥n:**
- Verificar que localStorage est√© habilitado
- No usar modo inc√≥gnito/privado
- Verificar configuraci√≥n del navegador (no bloquear cookies/storage)

---

### M√≥dulo ear-training no disponible

**Problema:** `window.__EAR_TRAINING` es undefined

**Soluci√≥n:**
- Los tests de Count-In y Fraction Recognition solo funcionan en App4
- Navega a `/apps/App4/` para acceder a estos tests
- Los dem√°s tests funcionan en cualquier app (App2-App5)

</details>

---

## üìù Notas Importantes

- **Modo Offline:** Todo se guarda en localStorage del navegador
- **Sin servidor:** No hay API ni base de datos externa
- **Usuario √∫nico:** Un solo usuario impl√≠cito por navegador
- **Gamificaci√≥n auto-inicializada:** Al cargar cualquier App (2-5), la gamificaci√≥n se activa autom√°ticamente
- **Comandos s√≠ncronos:** La mayor√≠a no necesitan `await`
- **Comandos as√≠ncronos:** Solo los de audio capture y ejercicios usan `await import()`
- **Permisos:** Tests de micr√≥fono requieren permisos del navegador
- **Foco de teclado:** Para tests con ESPACIO, aseg√∫rate de que el foco est√© en la p√°gina
- **Backup:** Usa `exportUserData()` para hacer backups peri√≥dicos
- **Calibraci√≥n de micr√≥fono:** Ajustada a margen de 3-4.5 dB (1.5x desviaci√≥n est√°ndar) para mejor sensibilidad

---

## üéÆ Comandos del Juego de App5

<details>
<summary>üéÆ Sistema de Juego UI (App5)</summary>

### 1. Configuraci√≥n del Modo de Entrada

```javascript
// Forzar modo teclado (√∫til en ambientes ruidosos)
window.gameForceKeyboard = true;

// Volver al modo micr√≥fono (por defecto)
window.gameForceKeyboard = false;

// Verificar modo actual
console.log('Modo:', window.gameForceKeyboard ? 'Teclado' : 'Micr√≥fono');
```

### 2. Acceso al Game Manager

```javascript
// Acceder al manager del juego
const gm = window.gameManager;

// Ver estado actual del juego
console.log(gm.gameState.getStatsSummary());

// Ver nivel actual
console.log('Nivel actual:', gm.gameState.currentLevel);

// Ver niveles completados
console.log('Completados:', gm.gameState.completedLevels);
```

### 3. Iniciar el Juego Manualmente

```javascript
// Simular click en bot√≥n de gamificaci√≥n
document.getElementById('gamificationToggleBtn')?.click();

// O directamente
window.gameManager.startGame();

// Cargar un nivel espec√≠fico
window.gameManager.loadLevel(1); // Niveles 1-4
```

### 4. Control del Personaje

```javascript
// Cambiar mood del personaje
window.gameManager.ui.character.setMood('happy');
window.gameManager.ui.character.setMood('sad');
window.gameManager.ui.character.setMood('thinking');
window.gameManager.ui.character.setMood('celebrating');
window.gameManager.ui.character.setMood('confused');
window.gameManager.ui.character.setMood('focused');
window.gameManager.ui.character.setMood('neutral');

// Animar personaje
window.gameManager.ui.character.animate('bounce');
window.gameManager.ui.character.animate('shake');
window.gameManager.ui.character.animate('pulse');
```

### 5. Gesti√≥n del Estado del Juego

```javascript
// Ver estad√≠sticas completas
const stats = window.gameManager.gameState.getStatsSummary();
console.table({
  'Progreso': stats.progress + '%',
  'Nivel Actual': stats.currentLevel,
  'Niveles Completados': stats.completedLevels,
  'Intentos Totales': stats.totalAttempts,
  'Tasa de √âxito': stats.successRate.toFixed(1) + '%',
  'Precisi√≥n Media': stats.averageAccuracy.toFixed(1) + '%',
  'Racha Actual': stats.currentStreak,
  'Mejor Racha': stats.bestStreak,
  'Logros': stats.achievementsUnlocked + '/' + stats.totalAchievements
});

// Resetear progreso (mantiene estad√≠sticas)
window.gameManager.gameState.reset(true);

// Resetear todo
window.gameManager.gameState.reset(false);

// Exportar datos del juego
const backup = window.gameManager.gameState.export();
console.log('Backup creado:', backup);

// Importar datos del juego
window.gameManager.gameState.import(backup);
```

### 6. Logros y Achievements

```javascript
// Ver todos los logros
const achievements = window.gameManager.gameState.achievements;
console.table(achievements);

// Ver descripci√≥n de logros
const achievementInfo = {
  firstStep: 'Completar nivel 1',
  evenOdd: 'Completar niveles 1 y 2',
  adaptive: 'Completar nivel 3 (din√°mico)',
  freeSpirit: 'Completar nivel 4 (libre)',
  perfectScore: 'Obtener 100% de precisi√≥n',
  streakMaster: 'Conseguir 5 victorias seguidas',
  speedDemon: 'Completar un nivel en menos de 10 segundos',
  persistent: 'Jugar 10 partidas',
  expert: 'Completar todos los niveles'
};
console.table(achievementInfo);
```

### 7. Control de Pulse Sequence

```javascript
// Ver texto actual del pulse sequence
const text = window.pulseSeqController.getText();
console.log('Pulse sequence:', text);

// Establecer un patr√≥n espec√≠fico
window.pulseSeqController.setText('P ( 1 3 5 ) Lg = 8');

// Obtener selecci√≥n sanitizada
const lg = 8;
const selection = '1 2 3 4 5';
const sanitized = window.gameManager.sanitizePulseSequence(selection, lg);
console.log('Sanitizado:', sanitized);
```

### 8. Tests de Niveles

```javascript
// Test r√°pido del nivel 1
async function testLevel1() {
  window.gameManager.loadLevel(1);
  // Establecer soluci√≥n correcta
  window.pulseSeqController.setText('P ( 1 3 ) Lg = 4');
  // Validar
  await window.gameManager.validatePhase1();
}
testLevel1();

// Test r√°pido del nivel 2
async function testLevel2() {
  window.gameManager.loadLevel(2);
  window.pulseSeqController.setText('P ( 2 4 ) Lg = 4');
  await window.gameManager.validatePhase1();
}
testLevel2();

// Ver configuraci√≥n de nivel din√°mico
import('./game/levels-config.js').then(module => {
  const level3 = module.getLevel(3);
  console.log('Nivel 3 generado:', level3);
});
```

### 9. Depuraci√≥n de Audio Capture

```javascript
// Test de captura con teclado
async function testKeyboardCapture() {
  window.gameForceKeyboard = true;
  const { createKeyboardCapture } = await import('./../../libs/gamification/index.js');
  const capture = createKeyboardCapture();

  console.log('Presiona ESPACIO 5 veces...');
  const promise = capture.startCapture();

  setTimeout(async () => {
    const beats = await capture.stopCapture();
    console.log('Beats capturados:', beats);
  }, 5000);
}
testKeyboardCapture();

// Test de calibraci√≥n de micr√≥fono
async function testMicCalibration() {
  window.gameForceKeyboard = false;
  const { createMicrophoneCapture } = await import('./../../libs/gamification/index.js');
  const mic = createMicrophoneCapture();

  console.log('Calibrando micr√≥fono...');
  await mic.calibrateNoiseFloor(2000);
  console.log('Calibraci√≥n completa');
}
testMicCalibration();
```

### 10. Workflow de Testing Completo del Juego

```javascript
// Test completo del flujo del juego
async function testGameFlow() {
  // 1. Configurar modo teclado
  window.gameForceKeyboard = true;
  console.log('‚úÖ Modo teclado activado');

  // 2. Iniciar juego
  window.gameManager.startGame();
  console.log('‚úÖ Juego iniciado');

  // 3. Cargar nivel 1
  await new Promise(r => setTimeout(r, 1000));
  window.gameManager.loadLevel(1);
  console.log('‚úÖ Nivel 1 cargado');

  // 4. Establecer soluci√≥n
  await new Promise(r => setTimeout(r, 500));
  window.pulseSeqController.setText('P ( 1 3 ) Lg = 4');
  console.log('‚úÖ Soluci√≥n establecida');

  // 5. Validar fase 1
  await new Promise(r => setTimeout(r, 500));
  await window.gameManager.validatePhase1();
  console.log('‚úÖ Fase 1 validada');

  // 6. Ver estad√≠sticas
  const stats = window.gameManager.gameState.getStatsSummary();
  console.log('üìä Estad√≠sticas:', stats);

  console.log('‚úÖ Test completo finalizado');
}
testGameFlow();
```

</details>

---

## üéØ Resumen de Tests Disponibles

### Tests R√°pidos (< 1 minuto)
1. ‚úÖ Verificar Sistema de Gamificaci√≥n - Instant√°neo
2. üéØ Trackear Acci√≥n de App - Instant√°neo
3. üîç Rhythm Analyzer - Instant√°neo
4. üß™ Guardar Intento - Instant√°neo

### Tests de Audio Capture (~1 minuto c/u)
1. ‚å®Ô∏è Keyboard Capture - 10 segundos (5 taps)
2. üé§ Microphone Capture + Calibraci√≥n - 7 segundos (2s calibraci√≥n + 5s captura)

### Tests de Ejercicios (requieren App4)
1. ‚è±Ô∏è Count-In - 2-4 segundos (visual + audio)
2. üéº Fraction Recognition - 2-3 minutos (10 preguntas autom√°ticas)

### Tests de Gamificaci√≥n (instant√°neos)
1. üìä Ver Estad√≠sticas y Progreso
2. üíæ Ver Intentos de Ejercicios
3. üë§ Gesti√≥n de Usuario
4. üíæ Backup y Restore

### Workflows Completos
1. üéØ Workflow B√°sico - ~10 minutos (todos los tests menos Fraction Recognition)
2. üéº Workflow con Fraction Recognition - ~13 minutos (solo en App4)

---

**üí° Tip Final:** Empieza con el "Workflow de Testing Completo" para probar todas las funcionalidades de forma ordenada.

**üìö Documentaci√≥n completa:**
- [DEVELOPMENT.md](DEVELOPMENT.md) - Gu√≠a de desarrollo
- [GAMIFICATION_PLAN.md](GAMIFICATION_PLAN.md) - Plan completo de gamificaci√≥n (actualizado para modo offline)
- [GAMIFICATION_USAGE_EXAMPLE.md](GAMIFICATION_USAGE_EXAMPLE.md) - Ejemplos detallados de gamificaci√≥n
- [GAMIFICATION_PROGRESS.md](GAMIFICATION_PROGRESS.md) - Progreso de implementaci√≥n

---

*√öltima actualizaci√≥n: 2025-10-15 - Versi√≥n Optimizada para Testing Workflow*
